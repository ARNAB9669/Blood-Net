const Url_map = {
    "Andaman and Nicobar Islands": "https://script.google.com/macros/s/AKfycbzHxKLVTix_LlM-sat-Pz7RDnRXqUTEQ7Thkmpo3TEXwpPATVsIjfpJukL238njNLhv9g/exec",
    "Andhra Pradesh": "https://script.google.com/macros/s/AKfycbwd99sa2sth-jo07XLMn6_JZMGkp6O4wExc4zK07YDlDzLwAjuCDCz9LgqrWH0Dq9i1QQ/exec",
    "Arunachal Pradesh": "https://script.google.com/macros/s/AKfycbxCgz2tvEGUPIsoRNcnOinLR8RcUI31pjNybPwfu8gE6K79OV4Yk_IigzWQCp3NsNp6/exec",
    "Assam": "https://script.google.com/macros/s/AKfycbyta2JeThWHdq6KpLIN30qB06cuPHIeRPuPJiaL4Dapb0saIq3cfxdMe1SzesdM8bhr/exec",
    "Bihar": "https://script.google.com/macros/s/AKfycbxem0gSNpt9eJayXtHtXJFpBicOMkRfos7zKyjMh78Cak_kqfhRMkENUgr1jRN6G7k/exec",
    "Chandigarh": "https://script.google.com/macros/s/AKfycbyQSBXeThRdDbcRlNguPsk3sxSOiFLU46OSfEzphAD4TN4nR1K4iXU-R1el-_VLoLJ5MA/exec",
    "Chhattisgarh": "https://script.google.com/macros/s/AKfycbzQZ7lVQ-bjMfMCkGDI8F1Zs907gQGlV9sYfsTgZYQY1HpyBMpH49gSAuFP1UPBMXk9/exec",
    "Dadra and Nagar Haveli and Daman and Diu": "https://script.google.com/macros/s/AKfycbxys3saIBuFA2W1j9DiaYKDRfYo7AL_XdrTe2fSvBGN92kyWxKXHUScURe2nXQPmH070A/exec",
    "Delhi": "https://script.google.com/macros/s/AKfycbz0DR2Z2r2Rkm4wgkedCL24nPi7s57vPuIOMd9BM6QOjpu9ZWhvoo30GpF8kqWucfdXWQ/exec",
    "Goa": "https://script.google.com/macros/s/AKfycbyxxPQCDpvv3HdXBZNmneghZGCUVzmzguUmYNZYHmnf4zW4YKDYNfYS-LNhSBfoKag-vw/exec",
    "Gujarat": "https://script.google.com/macros/s/AKfycbxyZ5mej7ffzhJ-cNWcb1IVi3qAJbkqesXa8guClsAcWiecL-NANMdI_OHn-k1kWEA/exec",
    "Haryana": "https://script.google.com/macros/s/AKfycbyPGlbk6nkbc6A4kho6qxVsqt2ispk6f9K_YEzyTyQeST1cAqLNZLfbEpz1dheLq1FkeA/exec",
    "Jammu and Kashmir": "https://script.google.com/macros/s/AKfycbwUDy16TQ7XWWd624mmwU-TV5Kv8znTA5MAZ3ioxqY0D9vqQDxBH7FHW44rFfDVe2ypHQ/exec",
    "Azad Kashmir": "https://script.google.com/macros/s/AKfycbz994Et3DcEIKm8fiNd8XKFTYvXGL-jWhcCHzpR1V6Xd05HeBBacTTGNZR5loBmYTur/exec",
    "Himachal Pradesh": "https://script.google.com/macros/s/AKfycbzlH6mVKFV61LHhH6dmqpaIMoftCaAGDTzVxFpsMOZq79wPZLHkK3KDItHEbkMK0znP/exec",
    "Jharkhand": "https://script.google.com/macros/s/AKfycbyoQHTGbD-N32ORrvHwqPc4BqSXqsJNXNGb0y2N6XhsWv974VIbwcNelx7C1RKx7hQ/exec",
    "Karnataka": "https://script.google.com/macros/s/AKfycbzwuoIT2NakwJorUQJcERvZONyAT1TNcnSWPvby3pVF1ecDTX3hw8YtQv-NBh1DJbUC/exec",
    "Kerala": "https://script.google.com/macros/s/AKfycbx-3c_mC7PhhGfBAwzeJnasADAKF-_GnAwnem-uymMKa79tt_xBs0RtcueU1qYzq8nGDQ/exec",
    "Ladakh": "https://script.google.com/macros/s/AKfycbxcIcHLdJ7hkMpcTBeB-JL1qF6WbTyboqF1hwkv1rSYPTNzcMiiD7EDAk_HW2whuW3_/exec",
    "Lakshadweep": "https://script.google.com/macros/s/AKfycby5IGtiHdu0lY2Z1RgW34MWe8G5GRHHBfpjSigyUZyyNy8boXDpOh89uZyJwHWIlReIFw/exec",
    "Madhya Pradesh": "https://script.google.com/macros/s/AKfycbzTLlKq5-POhmmhaElGgII6zuZSi3DksGRMVSIh4XPsUNrLLV_w2-YYyq98P38zAIjG/exec",
    "Maharashtra": "https://script.google.com/macros/s/AKfycbwm9b04FsYY_5-wqrcwSBIKZsW1B6WbSjSfS2xCTG8YuKY4ec0Bq98MKNa9N6I-6a-w/exec",
    "Manipur": "https://script.google.com/macros/s/AKfycbydTZAhKHzS_X11bCbKTIeHXqjpmuetzPd7_LZcyZYOg797sfA1dJAN15E_ls_TdTi6/exec",
    "Meghalaya": "https://script.google.com/macros/s/AKfycbzkuorOOsezqDL1rX0ouE0avK404pWk_yp7WqdzFwoPSNk79pMoSkXCBZJXYoj_G22dYQ/exec",
    "Mizoram": "https://script.google.com/macros/s/AKfycbzsDE9Asf_crTKeMJ_W0AGBnlxXRNrUaWmqhHuTPzdUf8RGj6xbxi09KtW8DpZmSqo3Sg/exec",
    "Nagaland": "https://script.google.com/macros/s/AKfycby2NoiPfzdMH5y0CygZeSbIr404_Zicy2M-ZyeLZHXnX2HiVyNIK-KaiIJ_Ri4G3b6v/exec",
    "Odisha": "https://script.google.com/macros/s/AKfycbwN3siYy0RaXJM-8HOFaMu62jz8PR2z5Fh-7NEkaC1-iYbo2YlTsAEGgV_NO090TJiW/exec",
    "Puducherry": "https://script.google.com/macros/s/AKfycbxGZgxyol-ynz9-nfMPQ1QPt9DP8asdml_xbGYHS2JZfU0qdGFPsA4DEsyQzUHi28_IUg/exec",
    "Punjab": "https://script.google.com/macros/s/AKfycbyZ6N_km_efZNZhlrh1CEwuhzYqczXanep_KZwE5vNnHivTUaMzXYrpDF_-Cm6ywFN9HQ/exec",
    "Rajasthan": "https://script.google.com/macros/s/AKfycbxAycxOnsIC_yloHBGBglknj1f9qocbpzETyNzo7TTzNbgevKrZwka3elrHVmZuW8Ov/exec",
    "Sikkim": "https://script.google.com/macros/s/AKfycbwF--SnbhnTuZqv2S3nAMl2o-3KpFtqiQRIp8Is1IpncTnfmlGW0te4PDO0L09d2Csqww/exec",
    "Tamil Nadu": "https://script.google.com/macros/s/AKfycbzBj16Q8OVOVKz46N4KnuX35uySRII4KuhHg7MbJn0sRUamDrlXipCI-YCaz73RhUwtKQ/exec",
    "Telangana": "https://script.google.com/macros/s/AKfycbytb2ZOKBnJwMvtaQ-3wWJ1p3bZSmSVN_IALgD9D4rQnQnhq2QPiKuyBEWNPBIGsxqJFQ/exec",
    "Tripura": "https://script.google.com/macros/s/AKfycbyac0PjWEdkFMQ6jozKm1M0JlYfkxcT_3oIQSeBgytMNVdNDZOqMg397ktpQHL0TfTeBg/exec",
    "Uttar Pradesh": "https://script.google.com/macros/s/AKfycbyMh-SO8xdkpZb9-x1X9VkIUc7SWY-ev8SwY0oFrLBPPLeOJntIM_zXyMfDHW2Mv74b/exec",
    "Uttarakhand": "https://script.google.com/macros/s/AKfycbw17b47uqIjKa4EMnrjLiYV5JaikiGszrorQ3kOZNFzcyeg8LSFsDKFmvYRPjfs9xrTKA/exec",
    "West Bengal": "https://script.google.com/macros/s/AKfycbyQyacDwdDgaZvfwCcWATT35N0WiPZtLErhr1AfaWNWH0KWKtVV9l3okmlVOU_8NgYWBw/exec"
};

document.addEventListener("DOMContentLoaded", () => {
    // If there is any district or city population code, it should go here.
    // (As per instructions, no submit logic here)
});

async function handleFormSubmit(event) {
    event.preventDefault();

    const submitButton = document.getElementById("submit");
    if (submitButton) {
        submitButton.disabled = true;
    }

    console.log("Engine fired successfully"); //Response 200;

    /* Starting Getting data*/
    const State = document.getElementById("state").value.trim();
    const District = document.getElementById("district").value.trim();
    const City = document.getElementById("city").value.trim();
    const First_Name = document.getElementById("first_name").value.trim();
    const Last_Name = document.getElementById("last_name").value.trim();
    const Age = document.getElementById("age").value.trim();
    const Blood_group = document.getElementById("blood_group").value.trim();
    const Phone_number = document.getElementById("phone_number").value.trim();
    const Sex = document.querySelector('input[name="gender"]:checked')?.value;
    /* Ending Getting data*/

    /* Validation started */
    if (!First_Name || !Last_Name || !Phone_number || isNaN(Age) || !Sex || !Blood_group || !District || !State || !City) {
        console.log("Stck! Fill all filed in the form.")
        alert("Please fill in all fields.");
        if (submitButton) {
            submitButton.disabled = false;
        }
        return;
    }
    const test = Phone_number.toString();
    if (!(test[0] === '9' || test[0] === '8' || test[0] === '7' || test[0] === '6')) {
        console.log("Stck! Phone number is not valid.")
        alert("The phone number is not valid.");
        if (submitButton) {
            submitButton.disabled = false;
        }
        return;
    }
    if (!/^\d{10}$/.test(Phone_number)) {
        alert("Please enter a valid 10-digit mobile number.");
        console.log("Stck! Phone number must be 10 digit.")
        if (submitButton) {
            submitButton.disabled = false;
        }
        return;
    }
    if (Age < 18 || Age > 65) {
        console.log("Age must be between 18 and 65.");
        alert("Age must be between 18 and 65.");
        if (submitButton) {
            submitButton.disabled = false;
        }
        return;
    }
    console.log("Got all valid Data")
    /* Velidation complete */

    /* Making the form data sendable */
    const formData = new URLSearchParams();
    formData.append("First_Name", First_Name);
    formData.append("Last_Name", Last_Name);
    formData.append("Phone_number", Phone_number);
    formData.append("Age", Age);
    formData.append("Sex", Sex);
    formData.append("Blood_group", Blood_group);
    formData.append("State", State);
    formData.append("District", District);
    formData.append("City", City);
    /* End of binding from data */

    /* Sending the form data */
    let url = Url_map[State];


    const loader = document.createElement("div");
    loader.id = "loader";
    loader.textContent = "Submitting...";
    loader.style.position = "fixed";
    loader.style.top = "50%";
    loader.style.left = "50%";
    loader.style.transform = "translate(-50%, -50%)";
    loader.style.padding = "20px 30px";
    loader.style.backgroundColor = "#00f2ff";
    loader.style.color = "#000";
    loader.style.borderRadius = "8px";
    loader.style.boxShadow = "0 0 15px #00f2ff";
    loader.style.zIndex = "9999";
    document.body.appendChild(loader);
    
    //Actually fetching data
    try {
        const response = await fetch(url, {
            method: "POST",
            body: formData,
        });

        const result = await response.text();
        console.log(result)
        alert(result);
        document.querySelector("form").reset();
    } catch (error) {
        console.log("Error submitting form:", error);
        console.error("Error submitting form:", error);
        console.log("Failed to submit. Please try again later.");
        alert("Failed to submit. Please try again later.");
    } finally {
        document.getElementById("loader")?.remove();
        if (submitButton) {
            submitButton.disabled = false;
        }
    }
}

const submitButton = document.getElementById("submit");
if (submitButton) {
    submitButton.addEventListener("click", handleFormSubmit);
}